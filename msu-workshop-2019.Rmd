---
title: "Wonâ€™t you be my neighboR?"
subtitle: "An introduction to R for data science in education"
author: "Joshua Rosenberg"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, custom.css]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

library(knitr)
library(tidyverse)
```

# Who am I?

.pull-left[
* Assistant Professor: STEM Education, University of Tennessee, Knoxville
* Dad (one-year-old toddler!)
* Primary areas of interest
+ Data science in education (network analytic methods, experience sampling method, computational grounded theory)
+ Data science education (integrating data science and science education)
]

```{r, out.width = "350px", echo = FALSE, fig.align = "center"}
include_graphics("img/kr-joro.jpg")
```

---

class: inverse, center, middle

# Agenda

---

# Agenda

1. Why learn R?
1. Getting started with R Studio
1. Visualizing data
1. Processing data
1. Learning and doing more with R
1. Modeling data (time permitting)
1. Computer programming basics (time permitting)
1. Creating reproducible reports (time permitting)

---

# Why learn R?

* It is capable of carrying out basic and complex statistical analyses
* It is able to work with data small (*n* = 30!) and large (*n* = 100,000+) efficiently
* It is a programming language and so is quite flexible
* There is a great, inclusive community of users and developers (and teachers)
* It is cross-platform, open-source, and freely-available

---

class: inverse, center, middle

# Getting started with R Studio

---

# To download R Studio:

- Visit this page to download R studio: [https://www.rstudio.com/products/rstudio/download/](https://www.rstudio.com/products/rstudio/download/)
- Find your operating system (Mac, Windows, or Linux)
- Download the 'latest release' on the page for your operating system and download and install the application

If you do have issues, consider this [page](https://datacarpentry.org/R-ecology-lesson/), and then reach out for help. One good place to start is the [R Studio Community](https://community.rstudio.com/) is a great place to start.

### Check that it worked

Open R Studio.  Find the console window and type in `2 + 2`. If what you can guess is returned (hint: it's what you expect!), then R Studio *and* R both work.

---
# Creating Projects

Before proceeding, we're going to take a few steps to set ourselves to make the analysis easier; namely, through the use of Projects, an R Studio-specific organizational tool. 

To create a project, in R Studio, navigate to "File" and then "New Directory". Then, click "New Project".

---

# Packages

"Packages" are shareable collections of R code that provide functions (i.e., a command to perform a specific task), data and documentation,. Packages increase the functionality of R by improving and expanding on base R (basic R functions). 

### Installing and Loading Packages

To download a package, you must call `install.packages()`:

```{r, eval = FALSE}
install.packages("dplyr", repos = "http://cran.us.r-project.org")
```

You can also navigate to the Packages pane, and then click "Install", which will work the same as the line of code above. This is a way to install a package using code or part of the R Studio interface. Usually, writing code is a bit quicker, but using the interface can be very useful and complimentary to use of code. 

---

# Using packages

*After* the package is installed, it must be loaded into your R Studio session using `library()`:

```{r}
library(dplyr)
```

We only have to install a package once, but to use it, we have to load it each time we start a new R session.

> a package is a like a book, a library is like a library; you use library() to check a package out of the library
> - Hadley Wickham, Chief Scientist, R Studio

---

# Running Functions from Packages

Once you have loaded the package in your session, you can run the functions that are contained within that package. To find a list of all those functions, you can run this in the R Studio console:

```{r, eval = FALSE}
help(package = dplyr)
```

The documentation should tell you what the function does, what arguments (i.e., details) needed for it to successfully run, examples, and what the output should look like.

---

# Vignettes

```{r, eval = FALSE}
vignette(package = "dplyr")
vignette("dplyr", package = "dplyr")
```

---

# Using a specific function

If you know the specific function that you want to look up, you can run this in the R Studio console:

```{r, eval = FALSE}
??dplyr::filter
```

Once you know what you want to do with the function, you can run it in your code:

```{r}
dat <- # example data frame
  data.frame(stringsAsFactors=FALSE,
             letter = c("A", "A", "A", "B", "B"),
             number = c(1L, 2L, 3L, 4L, 5L))

dat

filter(dat, letter == "A") # using dplyr::filter
```

---


# Configuring R Studio

One important consideration is whether to save your workspace when you close R Studio. By default, R Studio saves all of the objects in your environment. This means that any data that you have loaded--or new data or objects that you have created, such as by merging two data sets together or creating a plot--will, by default, still exist when you open R Studio next. In general, this is not ideal, because it means that you may have taken steps interactively that are not documented your code. This means that when you share your code, or re-run it from the start, it may not work. An easy way to change this is to tell R Studio to start from scratch (in terms of your workspace) each time you open it. You can do that by changing the dropdown menu pointed out in the image below to "Never".

![optional caption text](images/save-workspace-reminder.jpg)
---

class: inverse, center, middle
# Processing data

---

# The Tidyverse

The Tidyverse is a set of packages for data manipulation, exploration, and visualization using the design philosophy of 'tidy' data. Tidy data has a specific structure: each variable is a column, each observation is a row, and each type of observational unit is a table.

The packages contained in the Tidyverse provide useful functions that augment base R functionality.

You can installing and load the complete tidyverse with:

```{r, eval = FALSE}
install.packages("tidyverse")
```

```{r, message = FALSE}
library(tidyverse)
```

**For more information on tidy data, check out [Hadley Wickhams's Tidy Data paper](http://vita.had.co.nz/papers/tidy-data.html).**
---

# Loading Data from Various Sources

### Saving a File from the Web

You'll need to copy this URL:

`https://goo.gl/bUeMhV`

Here's what it resolves to (it's a CSV file):

`https://raw.githubusercontent.com/data-edu/data-science-in-education/master/data/pisaUSA15/stu-quest.csv`

```{r, eval = FALSE}
student_responses_url <-
  "https://goo.gl/bUeMhV"

student_responses_file_name <-
  paste0(getwd(), "./data/student-responses-data.csv")

download.file(
  url = student_responses_url,
  destfile = student_responses_file_name)
```

It may take a few seconds to download as it's around 20 MB.

The process above involves many core data science ideas and ideas from programming/coding. We will walk through them step-by-step.

---

# Step 1

1. The *character string* `"https://goo.gl/wPmujv"` is being saved to an *object* called `student_responses_url`.

```{r}
student_responses_url <-
  "https://goo.gl/bUeMhV"
```

---

# Step 2

2. We concatenate your working directory file path to the desired file name for the CSV using a *function* called `paste0`. This is stored in another *object* called `student_reponses_file_name`. This creates a file name with a *file path* in your working directory and it saves the file in the folder that you are working in. 

```{r}
student_responses_file_name <-
  paste0(getwd(), "./data/student-responses-data.csv")
```

---

# Step 3

3. The `student_responses_url` *object* is passed to the `url` argument of the *function* called `download.file()` along with `student_responses_file_name`, which is passed to the `destfile` argument.

In short, the `download.file()` function needs to know
- where the file is coming from (which you tell it through the `url`) argument and
- where the file will be saved (which you tell it through the `destfile` argument).

```{r, eval = FALSE}
download.file(
  url = student_responses_url,
  destfile = student_responses_file_name)
```

Understanding how R is working in these terms can be helpful for troubleshooting and reaching out for help. It also helps you to use functions that you have never used before because you are familiar with how some functions work.

---

# Loading a CSV File

Okay, we're ready to go. The easiest way to read a CSV file is with the function `read_csv()` from the package `readr`, which is contained within the Tidyverse.

---

# Loading the file

Let's load the tidyverse library:

```{r, message = F}
library(tidyverse) # so tidyverse packages can be used for analysis
```

After loading the tidyverse packages, we can now load a file. We are going to call the data `student_responses`:

```{r, eval = TRUE}
student_responses <-
  read_csv("./data/student-responses-data.csv")
```

Since we loaded the data, we now want to look at it. We can type its name in the function `glimpse()` to print some information on the dataset (this code is not run here).

```{r, eval = FALSE}
glimpse(student_responses)
```

---

# Loading Excel files

```{r, eval = FALSE}
install.packages("readxl")
```

```{r}
library(readxl)
```

We can then use the function `read_excel()` in the same way as `read_csv()`, where "path/to/file.xlsx" is where an Excel file you want to load is located (note that this code is not run here):

```{r, eval = FALSE}
my_data <-
  read_excel("path/to/file.xlsx")
```

---

# Loading SAV files

```{r, eval = FALSE}
install.packages("haven")
```

```{r, eval = FALSE}
library(haven)
my_data <-
  read_sav("path/to/file.xlsx")
```

---

# Saving Files

Using our data frame `student_responses`, we can save it as a CSV (for example) with the following function. The first argument, `student_reponses`, is the name of the object that you want to save. The second argument, `student-responses.csv`, what you want to call the saved dataset.

```{r, eval = FALSE}
write_csv(student_responses, "student-responses.csv")
```

That will save a CSV file entitled `student-responses.csv` in the working directory. If you want to save it to another directory, simply add the file path to the file, i.e. `path/to/student-responses.csv`. To save a file for SPSS, load the haven package and use `write_sav()`. There is not a function to save an Excel file, but you can save as a CSV and directly load it in Excel.

---
class: inverse, center, middle
# Processing Data
---

# The pipe: %>% 

We're also going to introduce a powerful, unusual *operator* in R, the pipe. The pipe is this symbol: `%>%`. It lets you *compose* functions. It does this by passing the output of one function to the next. A handy shortcut for writing out `%>%` is Command + Shift + M.

Here's an example. Let's say that we want to select a few variables from the `student_responses` dataset and save those variables into a new object, `student_mot_vars`. Here's how we would do that using `dplyr::select()`.

```{r}
student_mot_vars <- # save object student_mot_vars by...
  student_responses %>% # using dataframe student_responses
  select(SCIEEFF, JOYSCIE, INTBRSCI, EPIST, INSTSCIE) # and selecting only these five variables
```

---

# Saving the results

Note that we saved the output from the `select()` function to `student_mot_vars` but we could also save it back to `student_responses`, which would simply overwrite the original data frame (the following code is not run here):

```{r, eval = FALSE}
student_responses <- # save object student_responses by...
  student_responses %>% # using dataframe student_responses
  select(student_responses, SCIEEFF, JOYSCIE, INTBRSCI, EPIST, INSTSCIE) # and selecting only these five variables
```

---

# Renaming

We can also rename the variables at the same time we select them. I put these on separate lines so I could add the comment, but you could do this all in the same line, too. It does not make a difference in terms of how `select()` will work.

```{r}
student_mot_vars <- # save object student_mot_vars by...
  student_responses %>% # using dataframe student_responses
  select(student_efficacy = SCIEEFF, # selecting variable SCIEEFF and renaming to student_efficiency
         student_joy = JOYSCIE, # selecting variable JOYSCIE and renaming to student_joy
         student_broad_interest = INTBRSCI, # selecting variable INTBRSCI and renaming to student_broad_interest
         student_epistemic_beliefs = EPIST, # selecting variable EPIST and renaming to student_epistemic_beliefs
         student_instrumental_motivation = INSTSCIE # selecting variable INSTSCIE and renaming to student_instrumental_motivation
  )
```

---

# Processing data (part 1 of 4)

* `select()`
* `rename()`
* `filter()`
* `mutate()`

---

# Processing data (part 2 of 4)

* `group_by()`
* `count()`
* `summarize()`

---

# Processing data (part 3 of 4)

* `left_join()`
* `right_join()`
* `semi_join()`
* `anti_join()`

---

# Processing data (part 4 of 4)

* `gather()`
* `spread()`

---

class: inverse, center, middle

# Modeling data

---

# Linear models

---

# Multi-level models

---

# Latent variable models

---

class: inverse, center, middle
# Creating reproducible reports

---

# R Markdown

---

# APA Tables

---

# Papaja

---

# Redoc

---


class: inverse, center, middle

# Computer programming basics

---

# Objects and variables

```{r}
my_object <- 1
my_other_object <- c(1:10)
```

Reading in a CSV and assigning it to an object

```{r}
my_df <- read_csv("example-data.csv")
my_df
```

---

# Data structures

- Data Frame

````{r}
data.frame(var1 = c("a", "b", "c"),
           var2 = c(4, 2, 5))
```

- Tibble

```{r}
library(tidyverse)
tibble(var1 = c("a", "b", "c"),
       var2 = c(4, 2, 5))
```

---

# Data structures

```{r}
vec1 = c("a", "b", "c")
vec1 
```

```{r}
vec2 = c(4, 2, 5)
vec2
```

```{r}
library(tibble)
tibble(var1 = vec1,
       var2 = vec2)
```

# Conditional logic 

- `ifelse()`

```{r}
vec1 <- runif(10) # generates random number between 0 and 1
d1 <- tibble(var1 = vec1)

d1 %>% 
  mutate(var2 = ifelse(vec1 >= .5, "greater", "lesser"))
```

- `dplyr::case_when()`

```{r}
d1 %>% 
  mutate(var2 = case_when(
    var1 >= .75 ~ "a lot",
    var1 >= .5 ~ "greater",
    var1 < .5 ~ "lesser",
    var1 <= .25 ~ "very little" 
  ))
```

---

# Functions

```{r}
mean(c(1, 2, 3))
```

```{r}
mean(c(1, 2, 3, NA))
```

```{r, eval = FALSE}
?mean
```

```{r}
mean(c(1, 2, 3, NA), na.rm = TRUE)
```

---

# Functions

```{r, eval = FALSE}
library(tidyverse)
read_directory <- function(directory) {
  map_df(list.files(directory), read_csv)
}

d <- read_directory("data")
```

---

# Iteration

```{r}
random_numbers <- rnorm(n = 10, mean = 0)
random_numbers
mean(random_numbers)
sd(random_numbers)
```

```{r}
library(tidyverse)
1:10 %>%
  map(~ rnorm(n = 10, mean = .x)) %>%
  map_dbl(mean)
```

---

# Learning and doing more with R

---

# Following up
